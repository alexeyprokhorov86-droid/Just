# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## –û–±–∑–æ—Ä

–í –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–º—É –∞–Ω–∞–ª–∏–∑—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç **—Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ** –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç—ã –∞—É–¥–∏–æ –∏ –≤–∏–¥–µ–æ –¥–ª—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è
- OCR —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

### üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã

| –¢–∏–ø —Ñ–∞–π–ª–∞ | –§–æ—Ä–º–∞—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|------------------|----------|
| **Word** (.docx, .doc) | –ß–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç | –ü–∞—Ä–∞–≥—Ä–∞—Ñ—ã –∏ —Ç–∞–±–ª–∏—Ü—ã |
| **Excel** (.xlsx, .xls) | CSV | –í—Å–µ –ª–∏—Å—Ç—ã —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ |
| **PowerPoint** (.pptx, .ppt) | –ß–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç | –¢–µ–∫—Å—Ç —Å–ª–∞–π–¥–æ–≤ –∏ —Ç–∞–±–ª–∏—Ü |
| **PDF** (.pdf) | –ß–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç + OCR | –°–Ω–∞—á–∞–ª–∞ —Ç–µ–∫—Å—Ç, –∑–∞—Ç–µ–º OCR –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ |

### üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

| –¢–∏–ø —Ñ–∞–π–ª–∞ | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|-----------|----------|
| **–§–æ—Ç–æ** (jpg, png, gif, webp) | Claude Vision OCR | –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ |

### üé• –ú—É–ª—å—Ç–∏–º–µ–¥–∏–∞

| –¢–∏–ø —Ñ–∞–π–ª–∞ | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|-----------|----------|
| **–í–∏–¥–µ–æ** (.mp4, .avi, .mov, .mkv) | Whisper | –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –∑–≤—É–∫–æ–≤–æ–π –¥–æ—Ä–æ–∂–∫–∏ |
| **–ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** | Whisper | –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç —Ä–µ—á–∏ |
| **–ê—É–¥–∏–æ —Ñ–∞–π–ª—ã** | Whisper | –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ |

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### Telegram —á–∞—Ç—ã

–ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ —á–∞—Ç–∞ (`tg_chat_*`) —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç:

```sql
CREATE TABLE tg_chat_XXX (
    ...
    media_analysis TEXT,     -- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ)
    content_text TEXT,       -- –ù–û–í–û–ï: –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
    ...
);

-- –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –≤–∫–ª—é—á–∞–µ—Ç content_text
CREATE INDEX idx_tg_chat_XXX_fts ON tg_chat_XXX
USING gin(to_tsvector('russian',
    COALESCE(message_text, '') || ' ' ||
    COALESCE(media_analysis, '') || ' ' ||
    COALESCE(content_text, '')
));
```

### Email –≤–ª–æ–∂–µ–Ω–∏—è

```sql
ALTER TABLE email_attachments
ADD COLUMN content_text TEXT;

COMMENT ON COLUMN email_attachments.content_text IS
'–ò–∑–≤–ª–µ—á–µ–Ω–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞: —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç—ã, OCR, —Ç–µ–∫—Å—Ç –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, CSV –∏–∑ Excel –∏ —Ç.–¥.';
```

## –ü—Ä–∏–º–µ—Ä—ã –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ

### üìä Excel —Ñ–∞–π–ª

```csv
=== –õ–∏—Å—Ç1 ===
"–ò–º—è","–§–∞–º–∏–ª–∏—è","Email"
"–ò–≤–∞–Ω","–ò–≤–∞–Ω–æ–≤","ivan@example.com"
"–ü–µ—Ç—Ä","–ü–µ—Ç—Ä–æ–≤","petr@example.com"

=== –õ–∏—Å—Ç2 ===
"–î–∞—Ç–∞","–°—É–º–º–∞","–û–ø–∏—Å–∞–Ω–∏–µ"
"2026-01-15","1500","–û–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥"
```

### üìù Word –¥–æ–∫—É–º–µ–Ω—Ç

```
–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞

–≠—Ç–æ –ø–µ—Ä–≤—ã–π –ø–∞—Ä–∞–≥—Ä–∞—Ñ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.

–í—Ç–æ—Ä–æ–π –ø–∞—Ä–∞–≥—Ä–∞—Ñ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ.

–ù–∞–∑–≤–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ
–ü–æ–ª–µ 1 | 100 | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π 1
–ü–æ–ª–µ 2 | 200 | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π 2
```

### üé§ –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

```
–ü—Ä–∏–≤–µ—Ç, —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –Ø —Ö–æ—á—É —Å–æ–æ–±—â–∏—Ç—å, —á—Ç–æ –≤—Å—Ç—Ä–µ—á–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –≤ 15:00. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
```

### üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º

```
–í–ê–ñ–ù–û–ï –û–ë–™–Ø–í–õ–ï–ù–ò–ï

–°–æ–±—Ä–∞–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç—Å—è 20 —è–Ω–≤–∞—Ä—è 2026 –≥–æ–¥–∞
–ú–µ—Å—Ç–æ: –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü-–∑–∞–ª –ê
–í—Ä–µ–º—è: 14:00

–ü–æ–≤–µ—Å—Ç–∫–∞ –¥–Ω—è:
1. –û–±—Å—É–∂–¥–µ–Ω–∏–µ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
2. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∫–≤–∞—Ä—Ç–∞–ª
```

## –§—É–Ω–∫—Ü–∏–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```python
# OCR –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
async def extract_text_from_image(image_data: bytes, media_type: str) -> str

# PDF —Ç–µ–∫—Å—Ç + OCR —Ñ–æ–ª–±—ç–∫
async def extract_text_from_pdf(pdf_data: bytes) -> str

# Word –¥–æ–∫—É–º–µ–Ω—Ç—ã
async def extract_text_from_word(file_data: bytes) -> str

# Excel –≤ CSV
async def extract_csv_from_excel(file_data: bytes, filename: str = "") -> str

# PowerPoint –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏
async def extract_text_from_pptx(file_data: bytes) -> str

# –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ
async def extract_transcript_from_audio(audio_path: str) -> str
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏—è

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

–ù–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- `PyPDF2` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF
- `openai-whisper` - —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∞—É–¥–∏–æ (—É–∂–µ –±—ã–ª)

### 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö:

```bash
python migrate_content_text.py
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –î–æ–±–∞–≤–∏—Ç –ø–æ–ª–µ `content_text` –≤–æ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —á–∞—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç –ø–æ–ª–µ `content_text` –≤ `email_attachments`
- –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ë–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IF NOT EXISTS`)

### 3. SQL –º–∏–≥—Ä–∞—Ü–∏—è (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

–î–ª—è –Ω–æ–≤—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
psql -U postgres -d knowledge_base -f 002_add_content_extraction.sql
```

## –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫

–ò–∑–≤–ª–µ—á–µ–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ (`content_text`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞:

```python
# –í bot.py:1568-1570
content_for_index = (
    message_data.get("message_text", "") + " " +
    message_data.get("media_analysis", "") + " " +
    message_data.get("content_text", "")  # ‚Üê –≤–∫–ª—é—á–µ–Ω–æ
)
await index_new_message(table_name, message_id, content_for_index)
```

## –õ–∏–º–∏—Ç—ã

### –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤
- –í–∏–¥–µ–æ: –º–∞–∫—Å–∏–º—É–º 40 –ú–ë
- –î—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã —Ç–æ–ª—å–∫–æ –ø–∞–º—è—Ç—å—é

### –û–±—ä–µ–º –∏–∑–≤–ª–µ–∫–∞–µ–º–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- PDF: –¥–æ 50 —Å—Ç—Ä–∞–Ω–∏—Ü (PyPDF2), –¥–æ 20 —Å—Ç—Ä–∞–Ω–∏—Ü (OCR fallback)
- Excel: –≤—Å–µ –ª–∏—Å—Ç—ã, –≤—Å–µ —Å—Ç—Ä–æ–∫–∏
- Word: –≤—Å–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã, –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
- PowerPoint: –≤—Å–µ —Å–ª–∞–π–¥—ã
- –ê—É–¥–∏–æ/–í–∏–¥–µ–æ: –ø–æ–ª–Ω—ã–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç

### –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
- –ü–æ–ª–µ `TEXT` –≤ PostgreSQL –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–∏–º–∏—Ç–∞
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ 1 –ì–ë –Ω–∞ –ø–æ–ª–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –î–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–ø—Ä–∏–º–µ—Ä–Ω–æ)

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è |
|----------|-------|
| OCR –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (Claude Vision) | 2-5 —Å–µ–∫ |
| PDF —Ç–µ–∫—Å—Ç (PyPDF2) | <1 —Å–µ–∫ |
| PDF OCR (20 —Å—Ç—Ä–∞–Ω–∏—Ü) | 40-100 —Å–µ–∫ |
| Excel —Ñ–∞–π–ª | <1 —Å–µ–∫ |
| Word –¥–æ–∫—É–º–µ–Ω—Ç | <1 —Å–µ–∫ |
| Whisper —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è (1 –º–∏–Ω—É—Ç–∞ –∞—É–¥–∏–æ) | 5-10 —Å–µ–∫ |

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

–ê–Ω–∞–ª–∏–∑ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞, –Ω–æ:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
- –î–ª—è PDF: —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –±—ã—Å—Ç—Ä—ã–π PyPDF2, —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º OCR
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º –≤ –ë–î

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```python
# –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º—É —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
cur.execute("""
    SELECT message_id, message_text, content_text
    FROM tg_chat_XXX
    WHERE to_tsvector('russian',
        COALESCE(message_text, '') || ' ' ||
        COALESCE(media_analysis, '') || ' ' ||
        COALESCE(content_text, '')
    ) @@ plainto_tsquery('russian', '–ø–æ–∏—Å–∫–æ–≤–∞—è —Ñ—Ä–∞–∑–∞')
""")
```

### RAG –∑–∞–ø—Ä–æ—Å—ã

```python
# –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —É—á–∏—Ç—ã–≤–∞–µ—Ç content_text –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
# —Ç–∞–∫ –∫–∞–∫ –æ–Ω –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î
result = await process_rag_query(
    "–ù–∞–π–¥–∏ –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –≤—Å—Ç—Ä–µ—á–∞—Ö –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö",
    chat_id=123456789
)
```

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ –±–µ–∑ `content_text` —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (NULL –∑–Ω–∞—á–µ–Ω–∏—è)
- –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã, –Ω–æ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –∏—Ö –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

## –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```
INFO - –¢–µ–∫—Å—Ç –∏–∑–≤–ª–µ—á–µ–Ω –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: 145 —Å–∏–º–≤–æ–ª–æ–≤
INFO - –ê—É–¥–∏–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–æ: 342 —Å–∏–º–≤–æ–ª–æ–≤
WARNING - PyPDF2 –Ω–µ —Å–º–æ–≥ –∏–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç: ...
ERROR - –û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ Word: ...
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ content_text
SELECT
    message_type,
    COUNT(*) as total,
    COUNT(content_text) as with_content,
    AVG(LENGTH(content_text)) as avg_length
FROM tg_chat_XXX
WHERE media_analysis IS NOT NULL
GROUP BY message_type;
```

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

–í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ OCR
3. –°–∂–∞—Ç–∏–µ –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (RTF, TXT –∏ —Ç.–¥.)
5. –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä—É–∫–æ–ø–∏—Å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
6. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

---

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2026-01-19
**–ê–≤—Ç–æ—Ä:** Claude Code
